<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            color: #333;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(to right, #2563eb, #4f46e5);
            color: white;
            border-radius: 8px;
        }
        .info-box {
            background-color: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th {
            background-color: #2563eb;
            color: white;
            padding: 12px;
            text-align: left;
        }
        td {
            padding: 10px;
            border-bottom: 1px solid #e2e8f0;
        }
        .zone-section {
            margin: 20px 0;
        }
        .zone-header {
            background-color: #f1f5f9;
            padding: 15px;
            font-weight: bold;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        .status-indicator {
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 12px;
            display: inline-block;
        }
        .status-success { background-color: #dcfce7; color: #166534; }
        .status-warning { background-color: #fef9c3; color: #854d0e; }
        .status-error { background-color: #fee2e2; color: #991b1b; }
        .summary {
            margin-top: 30px;
            padding: 15px;
            background-color: #f8fafc;
            border-radius: 8px;
        }
        .footer {
            text-align: center;
            margin-top: 40px;
            font-size: 12px;
            color: #64748b;
            border-top: 1px solid #e2e8f0;
            padding-top: 20px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Rapport des Écarts d'Inventaire</h1>
        <p th:text="${'Plan: ' + plan.nom + ' - Généré le ' + #temporals.format(#temporals.createNow(), 'dd/MM/yyyy HH:mm')}"></p>
    </div>

    <div class="info-box">
        <h2>Informations du Plan</h2>
        <p th:text="${'Date de début: ' + #temporals.format(plan.dateDebut, 'dd/MM/yyyy')}"></p>
        <p th:text="${'Date de fin: ' + #temporals.format(plan.dateFin, 'dd/MM/yyyy')}"></p>
        <p th:text="${'Statut: ' + plan.statut}"></p>
    </div>

    <div th:each="zone : ${zones}" class="zone-section">
        <div class="zone-header" th:text="${'Zone: ' + zone.name}"></div>
        <table>
            <thead>
                <tr>
                    <th>Produit</th>
                    <th>Référence</th>
                    <th>Qté Théorique</th>
                    <th>Qté Manuel</th>
                    <th>Qté Scan</th>
                    <th>Écart</th>
                    <th>État</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="product : ${zone.products}">
                    <td th:text="${product.nom}"></td>
                    <td th:text="${product.codeBarre}"></td>
                    <td th:text="${product.quantiteTheorique}"></td>
                    <td th:text="${product.quantiteManuelle ?: '-'}"></td>
                    <td th:text="${product.quantiteScan ?: '-'}"></td>
                    <td th:text="${product.ecart ?: '-'}"></td>
                    <td>
                        <span class="status-indicator"
                              th:classappend="${
                                product.ecart == 0 ? 'status-success' : 
                                (product.ecart > 0 ? 'status-warning' : 'status-error')
                              }"
                              th:text="${
                                product.ecart == 0 ? 'Conforme' : 
                                (product.ecart > 0 ? 'Surplus' : 'Manquant')
                              }">
                        </span>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="summary">
        <h3>Résumé des Écarts</h3>
        <p th:text="${'Total des produits: ' + totalProducts}"></p>
        <p th:text="${'Produits conformes: ' + conformProducts}"></p>
        <p th:text="${'Produits avec écarts: ' + nonConformProducts}"></p>
        <p th:text="${'Taux de conformité: ' + #numbers.formatDecimal(conformityRate, 1, 2) + '%'}"></p>
    </div>

    <div class="footer">
        <p>Document généré automatiquement par le système de gestion d'inventaire</p>
        <p th:text="${'Page 1'}"></p>
    </div>
</body>
</html>